# Model Configuration - Fleet & Logistics (ML Engineer B)

# Equipment Failure Prediction Model
equipment_failure:
  model_name: "equipment_failure_prediction"
  model_type: "classification"

  # Algorithm selection
  algorithms:
    - xgboost
    - random_forest
    - gradient_boosting

  # XGBoost hyperparameters
  xgboost:
    n_estimators: 400
    max_depth: 6
    learning_rate: 0.03
    subsample: 0.8
    colsample_bytree: 0.8
    scale_pos_weight: 10 # handle imbalanced data (Breakdown << Beroperasi)
    objective: "binary:logistic"
    eval_metric: "auc"
    random_state: 42

  # Random Forest hyperparameters
  random_forest:
    n_estimators: 400
    max_depth: 12
    min_samples_split: 5
    min_samples_leaf: 2
    class_weight: "balanced"
    random_state: 42

  # Gradient Boosting hyperparameters
  gradient_boosting:
    n_estimators: 300
    max_depth: 6
    learning_rate: 0.05
    subsample: 0.8
    random_state: 42

  # Feature selection
  features:
    equipment:
      - tipe_alat
      - umur_tahun
      - kondisi
      - durasi_jam
      - total_muatan_ton
      - jumlah_ritase
    usage_patterns:
      - avg_daily_ritase_last_7d
      - total_working_hours_last_30d
      - cumulative_working_hours
      - days_since_last_maintenance # engineered
    weather_impact:
      - suhu_max_c
      - kelembaban_rh_avg
      - hujan_mm
      - exposure_to_extreme_weather_days # engineered
    operational:
      - shift
      - day_of_week
      - lokasi_kode

  # Target variable
  target: "status_operasi" # Binary: Breakdown (1) vs Beroperasi (0)

  # Class mapping
  class_labels:
    0: "Beroperasi"
    1: "Breakdown"

  # Handling class imbalance
  imbalance_strategy: "SMOTE" # SMOTE | ADASYN | RandomOverSampler | None
  imbalance_params:
    sampling_strategy: 0.3 # target ratio of minority to majority class
    k_neighbors: 5

  # Evaluation metrics
  metrics:
    primary: "recall" # prioritize catching failures
    secondary:
      - precision
      - f1
      - roc_auc
      - pr_auc # Precision-Recall AUC

  # Performance targets
  targets:
    recall: 0.80 # catch 80%+ of failures
    precision: 0.70
    f1: 0.75
    roc_auc: 0.85

# Performance Degradation Model
performance_degradation:
  model_name: "performance_degradation"
  model_type: "regression"

  # Algorithm selection
  algorithms:
    - xgboost
    - lightgbm
    - linear_regression

  # XGBoost hyperparameters
  xgboost:
    n_estimators: 300
    max_depth: 5
    learning_rate: 0.05
    subsample: 0.8
    colsample_bytree: 0.8
    objective: "reg:squarederror"
    eval_metric: "rmse"
    random_state: 42

  # LightGBM hyperparameters
  lightgbm:
    n_estimators: 300
    max_depth: 5
    learning_rate: 0.05
    num_leaves: 31
    subsample: 0.8
    colsample_bytree: 0.8
    objective: "regression"
    metric: "rmse"
    random_state: 42

  # Linear Regression (baseline)
  linear_regression:
    fit_intercept: true

  # Feature selection
  features:
    equipment:
      - umur_tahun
      - cumulative_working_hours
      - total_muatan_ton_rolling_30d
      - jumlah_ritase_rolling_30d
    historical_performance:
      - efficiency_ratio_baseline # from first month of operation
      - efficiency_ratio_rolling_7d
      - efficiency_ratio_rolling_30d
      - degradation_trend_slope # linear trend
    environmental:
      - avg_temperature_exposure_30d
      - avg_humidity_exposure_30d
      - total_rain_exposure_30d

  # Target variable
  target: "efficiency_ratio" # durasi_jam / total_muatan_ton (lower is better)

  # Evaluation metrics
  metrics:
    primary: "r2"
    secondary:
      - rmse
      - mae
      - mape

  # Performance targets
  targets:
    r2: 0.70
    rmse: 0.05 # efficiency ratio units
    mae: 0.04
    mape: 0.15

# Port Operability Prediction Model
port_operability:
  model_name: "port_operability_prediction"
  model_type: "classification"

  # Algorithm selection
  algorithms:
    - xgboost
    - lightgbm
    - logistic_regression

  # XGBoost hyperparameters
  xgboost:
    n_estimators: 200
    max_depth: 4
    learning_rate: 0.05
    subsample: 0.8
    colsample_bytree: 0.8
    objective: "binary:logistic"
    eval_metric: "auc"
    random_state: 42

  # LightGBM hyperparameters
  lightgbm:
    n_estimators: 200
    max_depth: 4
    learning_rate: 0.05
    num_leaves: 15
    subsample: 0.8
    colsample_bytree: 0.8
    objective: "binary"
    metric: "auc"
    random_state: 42

  # Logistic Regression hyperparameters
  logistic_regression:
    penalty: "l2"
    C: 1.0
    solver: "lbfgs"
    max_iter: 1000
    random_state: 42

  # Feature selection
  features:
    marine_weather:
      - angin_kecepatan_avg_ms
      - angin_gust_max_ms
      - visibilitas_km_avg
      - angin_arah_derajat
      - tekanan_hpa_avg
    weather_forecast:
      - angin_kecepatan_forecast_6h
      - angin_kecepatan_forecast_12h
      - hujan_mm_forecast_6h
    historical:
      - loading_delay_frequency_last_30d
      - avg_loading_duration_last_10_operations
    temporal:
      - hour
      - day_of_week
      - month # seasonal patterns
    tide: # if available
      - tide_height_forecast # proxy using weather if not available

  # Target variable
  target: "can_operate" # Binary: 1 (can load) vs 0 (cannot load)

  # Class mapping
  class_labels:
    0: "Cannot Operate"
    1: "Can Operate"

  # Evaluation metrics
  metrics:
    primary: "precision" # minimize false alarms (cancel when actually can operate)
    secondary:
      - recall
      - f1
      - roc_auc
      - specificity # True Negative Rate

  # Performance targets
  targets:
    precision: 0.85 # minimize false positives
    recall: 0.80
    f1: 0.82
    roc_auc: 0.88
    specificity: 0.85

# Vessel Loading Duration Model (Bonus)
vessel_loading_duration:
  model_name: "vessel_loading_duration"
  model_type: "regression"

  # Algorithm selection
  algorithms:
    - xgboost
    - random_forest

  # XGBoost hyperparameters
  xgboost:
    n_estimators: 200
    max_depth: 5
    learning_rate: 0.05
    subsample: 0.8
    colsample_bytree: 0.8
    objective: "reg:squarederror"
    eval_metric: "rmse"
    random_state: 42

  # Feature selection
  features:
    vessel:
      - tipe_kapal
      - rencana_muatan
    stockpile:
      - total_kuantitas_ton
      - calorific_value
      - total_moisture
    weather:
      - angin_kecepatan_avg_ms
      - hujan_mm
    operational:
      - hour_of_day
      - day_of_week
    historical:
      - avg_loading_rate_last_5_vessels # ton per hour

  # Target variable
  target: "loading_duration_hours" # waktu_selesai_muat - waktu_mulai_muat

  # Evaluation metrics
  metrics:
    primary: "mape"
    secondary:
      - rmse
      - mae
      - r2

  # Performance targets
  targets:
    mape: 0.20 # 20%
    rmse: 2.0 # hours
    mae: 1.5
    r2: 0.70

# Fleet Risk Scoring System
fleet_risk_scoring:
  model_name: "fleet_risk_scoring"
  model_type: "rule_based_ml_hybrid"

  # Risk components (weighted)
  risk_components:
    equipment_failure_probability:
      weight: 0.35
      source: "equipment_failure model prediction"
    performance_degradation_score:
      weight: 0.25
      source: "performance_degradation model"
    weather_exposure_risk:
      weight: 0.20
      source: "weather severity index"
    maintenance_overdue:
      weight: 0.15
      source: "days_since_last_maintenance"
    operational_stress:
      weight: 0.05
      source: "workload last 7 days vs average"

  # Risk score calculation
  scoring:
    method: "weighted_sum" # weighted_sum | logistic_function
    range: [0, 100] # 0 = no risk, 100 = critical risk

  # Risk categories
  risk_categories:
    - name: "Low Risk"
      threshold: [0, 30]
      color: "green"
      action: "Continue normal operations"
    - name: "Medium Risk"
      threshold: [30, 60]
      color: "yellow"
      action: "Monitor closely, schedule preventive maintenance"
    - name: "High Risk"
      threshold: [60, 80]
      color: "orange"
      action: "Reduce workload, expedite maintenance"
    - name: "Critical Risk"
      threshold: [80, 100]
      color: "red"
      action: "Immediate inspection, consider taking offline"

  # Alert thresholds
  alerts:
    high_risk_threshold: 60
    critical_risk_threshold: 80
    notification_channels:
      - "agentic_ai"
      - "maintenance_team"
      - "operations_manager"

# Hyperparameter Tuning
hyperparameter_tuning:
  method: "optuna"
  n_trials: 80
  timeout_seconds: 5400 # 1.5 hours

  # Optuna specific
  optuna:
    sampler: "TPE"
    pruner: "MedianPruner"
    n_jobs: -1

# Feature Engineering
feature_engineering:
  # Missing value handling
  missing_values:
    strategy: "interpolate" # for equipment sensor data
    max_consecutive_missing: 5

  # Outlier detection
  outliers:
    method: "isolation_forest"
    contamination: 0.05 # expect 5% outliers
    action: "clip"

  # Scaling
  scaling:
    numerical: "robust" # robust to outliers
    categorical: "onehot"

# Model Interpretability
interpretability:
  # SHAP analysis
  shap:
    enabled: true
    n_samples: 800
    plot_types:
      - summary_plot
      - dependence_plot
      - waterfall_plot # for individual predictions

  # Feature importance
  feature_importance:
    enabled: true
    top_n: 20

  # Calibration
  calibration:
    enabled: true # for probability calibration
    method: "isotonic" # isotonic | platt

# Model Validation
validation:
  # Cross-validation strategy
  cv_strategy: "stratified_time_series_split" # preserve class balance + temporal order
  n_splits: 5

  # Validation metrics thresholds
  acceptance_criteria:
    equipment_failure:
      min_recall: 0.75 # critical: must catch failures
      min_f1: 0.70
      min_roc_auc: 0.80
    performance_degradation:
      min_r2: 0.65
      max_rmse: 0.06
    port_operability:
      min_precision: 0.80 # critical: avoid false alarms
      min_f1: 0.78

# Cost-Benefit Analysis
cost_benefit:
  # Cost parameters (IDR)
  cost_breakdown: 50000000 # Rp 50M per unplanned breakdown
  cost_maintenance_planned: 5000000 # Rp 5M per planned maintenance
  cost_false_alarm: 2000000 # Rp 2M per false port closure
  cost_missed_failure: 50000000 # Rp 50M if failure not caught

  # Expected savings calculation
  expected_savings:
    enabled: true
    baseline_breakdown_rate: 0.10 # 10% breakdown rate without ML
    target_breakdown_rate: 0.06 # 6% with ML
    fleet_size: 100
    operations_per_year: 365
